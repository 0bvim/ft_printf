# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: vde-frei <vde-frei@student.42sp.org.br>    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2023/08/24 17:36:04 by vde-frei          #+#    #+#              #
#    Updated: 2023/10/16 11:30:46 by vde-frei         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

### CONFIGURATION AND SETUP FILES ###

# END FILE NAME #
NAME = libftprintf.a

# IF YOU'LL NOT USE LIBFT, JUST DON'T USE THIS VARIABLE # 
LIBFT = lib/libft/libft.a

# PATHS #
SRC_PATH = sources/
BNS_PATH = ./sources/bonus

# SETTING SHELL TO USE FOR COUNT AND PRINT PERCENTAGE #
SHELL := /bin/bash
COUNT := 0

# COLORS #
BLACK  		 = \033[0;30m
RED    		 = \033[0;31m
GREEN  		 = \033[0;32m
YELLOW 		 = \033[0;33m
BLUE   		 = \033[0;34m
MAGENTA		 = \033[0;35m
CYAN   		 = \033[0;36m
WHITE  		 = \033[0;37m
RESET  		 = \033[0m

# FLAGS #
DFLAGS = -Wall -Wextra -Werror -g3 # TO DEBBUG
CFLAGS = -Wall -Werror -Wextra -O3 -fomit-frame-pointer -finline-functions # TO IMPROVE PERFORMANCE
ARFLAGS = -rcs

# '.C' FILES #
CFILES = ft_printf.c ft_put.c ft_print_var.c ft_flags_utils.c ft_putnbr_base.c \
		 ft_atoi.c ft_numbers.c ft_putchar.c ft_putstr.c

# BONUS FILES #
BFILES = ft_printf_bonus.c ft_put_bonus.c ft_print_var_bonus.c \
		 ft_flags_utils_bonus.c ft_putnbr_base_bonus.c ft_atoi_bonus.c \
		 ft_numbers_bonus.c ft_putchar_bonus.c ft_putstr_bonus.c

# INDEX FILES TO PATH #
SRC = $(addprefix $(SRC_PATH), $(CFILES))

# DIRECTORY TO STORE CREATED OBJ FILES #
OBJ_DIR = ./obj/

# PATH TO INPUT FILES #
OBJ = $(addprefix $(OBJ_DIR), $(SRC:%.c=%.o))

# INCLUDES #
INCLUDES = -I./ -I./includes

# IF YOU HAVE INCLUDES FROM OTHERS LIB LIKE LIBFT #
LINCLUDES ?=

# CHANGE PATHS AND FILE TO MAKE BONUS #
ifdef WITH_BONUS
	CFILES = $(BFILES)
	SRC_PATH = $(BNS_PATH)
endif

# CHANGE FLAGS FOR DEBUGG #
ifdef WITH_DEBBUG
	CFLAGS = $(DFLAGS)
endif

# RECIPE #
all: $(NAME)

# CREATE OBJ DIR #
obj:
	mkdir -p $(OBJ_DIR)

# CREATE OBJ FILES #
obj/%.o: %.c
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(NAME): obj $(OBJ)
	$(AR) $(ARFLAGS) $(NAME) $(OBJ)

%.o:%.c
	$(eval COUNT=$(shell expr $(COUNT) + 1))
	cc $(CFLAGS) -I ./ -c $< -o $@
	printf "$(GREEN)Compiling FdF %d%%\r$(RESET)" $$(echo $$(($(COUNT) * 100 / $(words $(CFILES)))))

# FLAGS TO AVOID CONFLICTS #
.PHONY: all bonus clean fclean re debbug
